<% content_for :title, "Appels de l'Équipe - WeSales" %>

<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <div class="mb-8">
    <h1 class="text-3xl font-bold" style="color: var(--dark-purple);">Appels de l'Équipe</h1>
    <p class="mt-2 text-gray-600">Consultez tous les appels de votre équipe</p>
  </div>

  <!-- Filters -->
  <div class="bg-white rounded-lg shadow border border-gray-100 mb-6 p-6">
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Membre</label>
        <select class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-orange-500">
          <option value="">Tous les membres</option>
          <% @team_members.each do |member| %>
            <option value="<%= member[:id] %>"><%= member[:name] %></option>
          <% end %>
        </select>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Type d'appel</label>
        <select class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-orange-500">
          <option value="">Tous les types</option>
          <option value="cold_call">Appel à froid</option>
          <option value="discovery_call">Découverte</option>
          <option value="negotiation_call">Négociation</option>
          <option value="closing_call">Closing</option>
          <option value="rfp_call">Soutenance AO</option>
        </select>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Statut</label>
        <select class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-orange-500">
          <option value="">Tous</option>
          <option value="analyzed">Analysé</option>
          <option value="processing">En cours</option>
        </select>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Période</label>
        <select class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-orange-500">
          <option value="">Toutes</option>
          <option value="week">Cette semaine</option>
          <option value="month">Ce mois</option>
        </select>
      </div>
    </div>
  </div>

  <!-- Calls Table -->
  <div class="bg-white rounded-lg shadow border border-gray-100">
    <table class="min-w-full divide-y divide-gray-200">
      <thead class="bg-gray-50">
        <tr>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Appel</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Membre</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Type</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Date</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Score</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Statut</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-200">
        <% @calls.each do |call| %>
          <tr class="hover:bg-gray-50 cursor-pointer" onclick="window.location='<%= manager_appel_path(call[:id]) %>'">
            <td class="px-6 py-4">
              <p class="text-sm font-medium text-gray-900"><%= call[:title] %></p>
              <p class="text-sm text-gray-500"><%= call[:client] %></p>
            </td>
            <td class="px-6 py-4 text-sm text-gray-900"><%= call[:member_name] %></td>
            <td class="px-6 py-4">
              <span class="px-2 py-1 text-xs rounded-full" style="background-color: var(--cream-orange); color: var(--dark-purple);">
                <%= call[:methodology] %>
              </span>
            </td>
            <td class="px-6 py-4 text-sm text-gray-500"><%= l(call[:date], format: :short) %></td>
            <td class="px-6 py-4">
              <% if call[:status] == "analyzed" %>
                <span class="text-sm font-bold" style="color: <%= call[:score] >= 80 ? 'var(--light-orange)' : 'var(--flash-purple)' %>;"><%= call[:score] %>%</span>
              <% else %>
                <span class="text-sm text-gray-400">—</span>
              <% end %>
            </td>
            <td class="px-6 py-4">
              <span class="px-2 py-1 text-xs rounded-full <%= call[:status] == 'analyzed' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800' %>">
                <%= call[:status] == 'analyzed' ? 'Analysé' : 'En cours' %>
              </span>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>
